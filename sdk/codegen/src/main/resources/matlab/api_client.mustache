% ApiClient - Wrapper for RestClient that provides an interface for api calls.
%
% ApiClient Properties:
%   restClient - The rest client instance
%
% ApiClient Methods:
%   callApi - Invoke a REST API call using restClient
classdef ApiClient
    % NOTE: This file is auto generated by the swagger code generator program.
    % Do not edit the file manually.
    properties
        restClient
    end
    methods
        function obj = ApiClient(apiKey)
            obj.restClient = io.flywheel.rest.RestClient.fromApiKey(apiKey);
        end
        function resp = callApi(obj, method, path, pathParams, queryParams, headers, body, postParams, files)
            resp = obj.restClient.callApi(method, path, pathParams, queryParams, headers, body, postParams, files);
            statusCode = resp.getStatusCode();
            if statusCode < 200 || statusCode > 299
                reason = resp.getReasonPhrase().toCharArray';
                throw(MException('ApiClient:apiException', '(%d) Reason: %s', statusCode, reason));
            end
        end
    end
    methods(Static)
        function json = encodeJson(data)
            json = jsonio.jsonwrite(data, struct('ReplacementStyle', 'hex'));
        end
        function json = getResponseJson(resp)
            body = resp.getBodyAsString().toCharArray';
            json = jsonio.jsonread(body, struct('ReplacementStyle', 'hex'));
        end
        function params = formatParamCollection(params, name, value, format)
            if iscell(value)
                if format == 'multi'
                    for val = value
                        params = [params, name, val];
                    end
                else
                    switch format
                        case 'ssv'
                            delimiter = ' ';
                        case 'tsv'
                            delimiter = '\t';
                        case 'pipes'
                            delimiter = '|';
                        otherwise
                            delimiter = ',';
                    end
                    params = [params, name, strjoin(value, delimiter)];
                end
            else
                params = [params, name, value];
            end
        end
    end
end
